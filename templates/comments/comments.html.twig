{% set nested = nested|default(false) %}
{% set locale = app.request.query.get('_locale') %}

{% if not nested %}
<section class="flex flex-col gap-6 py-4 px-6">
  <h1 class="text-2xl text-center font-colombia">
    {{ 'app.comment.title'|trans({
      totalComments: totalComments,
    }, locale = locale) }}
  </h1>
{% endif %}

  {% for comment in comments %}
    {% include commentTemplate with {
      threadId: threadId,
      comment: comment,
      referrer: referrer,
      nestedComments: nestedComments,
      commentTemplate: commentTemplate,
      commentsTemplate: commentsTemplate,
      nested: nested,
    } only %}
    {% if not loop.last and not nested %}<hr>{% endif %}
  {% else %}
    {% if not nested %}
      <p>{{ 'app.comment.no_comments'|trans(locale = locale) }}</p>
    {% endif %}
  {% endfor %}

{% if not nested %}
  {% if form|default %}
    <hr>
    {% if is_granted('ROLE_USER') %}
      <h2 class="text-xl text-center font-colombia">
        {{ 'app.comment.add_title'|trans(locale = locale) }}
      </h2>
      {{ form(form) }}
    {% else %}
      <p class="text-center">
        {{ 'app.comment.login'|trans(locale = locale) }}
      </p>
    {% endif %}
  {% endif %}
</section>
{% endif %}
